# ==============================================================================
# model_enhanced_duet_debug.yaml
# Enhanced version of your original model_duet_debug.yaml
# ==============================================================================

# # OPTION 1: Enhanced ReactModel (recommended to start with)
# NAME: EnhancedReactModel  # New enhanced version
# NUM_LAYERS: 20

OPTION 2: Enhanced DuetModel (if you want to try full duet generation)
NAME: EnhancedDuetModel
NUM_LAYERS: 20

# === RETRIEVAL CONFIGURATION ===
USE_RETRIEVAL: True
RETRIEVAL:
  num_retrieval: 4              # Number of retrieved motions to use
  topk: 10                      # Top-k candidates to choose from
  retrieval_file: null          # Will be auto-generated during training
  latent_dim: 512              # Match your LATENT_DIM
  max_seq_len: 300             # Adjust based on your max sequence length
  num_motion_layers: 4         # Layers in motion encoder
  num_heads: 8                 # Match your NUM_HEADS  
  ff_size: 1024                # Match your FF_SIZE
  stride: 4                    # Downsampling for efficiency
  
  # Similarity weights (should sum to ~1.0)
  text_weight: 0.4             # Weight for text similarity
  music_weight: 0.3            # Weight for music similarity  
  kinematic_weight: 0.2        # Weight for motion length similarity
  interaction_weight: 0.1      # Weight for dancer interaction patterns
  dropout: 0.1                 # Match your DROPOUT

# === EXISTING PARAMETERS (keep same) ===
NUM_HEADS: 8
DROPOUT: 0.1
INPUT_DIM: 262                 # Keep your existing dimension
LATENT_DIM: 512
FF_SIZE: 1024
MUSIC_DIM: 4800                # Keep your existing music dimension
ACTIVATION: gelu

# Resume from your existing checkpoint if desired
CHECKPOINT: #checkpoints/react20_both_juke/model/model=ReactModel-epoch=599-step=3600.ckpt

DIFFUSION_STEPS: 200           # Keep same
BETA_SCHEDULER: cosine         # Keep same  
SAMPLER: uniform               # Keep same

MOTION_REP: global             # Keep same
FINETUNE: False                # Keep same

TEXT_ENCODER: clip             # Keep same
T_BAR: 200                     # Keep same

CONTROL: text                  # Keep same
STRATEGY: ddim50               # Keep same
CFG_WEIGHT: 3.5                # Keep same

USE_TEXT: True                 # Keep same
USE_MUSIC: True                # Keep same

# === NEW RETRIEVAL-SPECIFIC PARAMETERS ===
# Conditioning scales for inference (can adjust during generation)
CONDITIONING_SCALES:
  text_scale: 1.0
  music_scale: 1.0  
  retrieval_scale: 1.0

# Progressive conditioning during inference
PROGRESSIVE_CONDITIONING: True